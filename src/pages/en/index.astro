---
import Header from "@/components/static/Header.astro";
import Section from "@/components/static/Section.astro";
import { getTranslations } from "@/i18n";
import Layout from "@/layouts/Layout.astro";
import { SECTION_COMPONENTS } from "@/utils";

const { currentLocale } = Astro;

if (!currentLocale)
  throw new Error("Locale not provided or default didn't load propperly");

const translation = getTranslations(currentLocale);

const { sections, site } = translation;
const { title: PAGE_TITLE, description: PAGE_DESCRIPTION } = site;
---

<Layout title={PAGE_TITLE} description={PAGE_DESCRIPTION}>
  <Header lang={currentLocale} />
  <main class="dark:text-white">
    {
      sections.map(async ({ label, url }) => {
        const loader = SECTION_COMPONENTS[url];

        if (!loader) return null;

        const Component = (await loader()).default;

        const variant = url === "about" ? "hero" : "normal";
        const isOptionalTitle = url === "about" ? false : true;

        return (
          <Section
            id={url}
            optionalTitle={isOptionalTitle}
            title={label}
            variant={variant}
          >
            <Component />
          </Section>
        );
      })
    }
  </main>
</Layout>
